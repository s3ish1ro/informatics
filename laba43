from PyQt5.QtWidgets import (QApplication, QLabel, QLineEdit, QMainWindow, QPushButton, QFormLayout, QWidget, QComboBox, QMessageBox, QTableWidget)
import matplotlib.pyplot as plt
import matplotlib.patches as ptch
from matplotlib.backends.backend_qt5agg import FigureCanvasQTAgg as FigureCanvas
from PIL import Image

im = Image.open('whitewallpaper.png')
class MainWindow(QMainWindow):
    def __init__(self, parent=None):
        super(MainWindow, self).__init__(parent)

        self.setWindowTitle('Задание 3')
        self.fig = plt.figure()
        self.canvas = FigureCanvas(self.fig)

        cental_widget = QWidget()
        layout = QFormLayout()
        cental_widget.setLayout(layout)

        self.setCentralWidget(cental_widget)

        self.life_table = QTableWidget()
        self.life_table.setColumnCount(5)
        self.life_table.setRowCount(3)
        self.life_table.setHorizontalHeaderLabels(['x', 'y', 'l', 'h', 'a'])
        self.life_table.setFixedWidth(650)

        self.object_table = QTableWidget()
        self.object_table.setColumnCount(3)
        self.object_table.setRowCount(3)
        self.object_table.setHorizontalHeaderLabels(['Тип объекта', 'x', 'y'])
        self.object_table.setFixedWidth(450)

        self.start_button = QPushButton('Старт')
        self.start_button.clicked.connect(self.plotd)

        layout.addRow(self.life_table, self.object_table)
        layout.addRow(self.canvas)
        layout.addRow(self.start_button)

        for i in range(self.object_table.rowCount() + 1):
            self.type_box = QComboBox()
            self.type_box.addItems(['ПВ', 'НС'])
            self.object_table.setCellWidget(i, 0, self.type_box)

    def plotd(self):
        axes = plt.subplot()
        axes.imshow(im)
        x, y = map(int, (self.life_table.item(0, 0).text(), self.life_table.item(0, 1).text()))
        l, h = map(int, (self.life_table.item(0, 2).text(), self.life_table.item(0, 3).text()))
        ang = int(self.life_table.item(0, 4).text())
        rect = ptch.Rectangle((x, y), l, h, linewidth=1, edgecolor='black', facecolor='none', angle=ang)
        axes.add_patch(rect)
        plt.grid(True)
        self.canvas.draw()


app = QApplication([])
main_window = MainWindow()
main_window.show()
app.exec()
